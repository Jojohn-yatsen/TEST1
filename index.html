<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GBA 風格問答對戰小遊戲（特效版）</title>
<style>
  body {
    font-family:"Noto Sans TC", Arial, sans-serif;
    margin:0; padding:0;
    display:flex; align-items:center; justify-content:center;
    min-height:100vh;
    background: linear-gradient(270deg, #87CEEB, #cde6ff, #a2d4ff);
    background-size: 600% 600%;
    animation: gradientShift 20s ease infinite;
  }
  @keyframes gradientShift {
    0%{background-position:0% 50%}
    50%{background-position:100% 50%}
    100%{background-position:0% 50%}
  }

  .screen{width:720px;max-width:96vw;background:#ffffffd9;border:6px solid #222;border-radius:12px;
          box-shadow:8px 8px 0 rgba(0,0,0,0.25);padding:12px;position:relative;overflow:hidden;}

  .center{display:flex;align-items:center;justify-content:center;flex-direction:column;}

  .btn{background:#222;color:#fff;padding:12px 20px;border-radius:10px;cursor:pointer;margin:8px;
       display:inline-block;text-decoration:none;font-size:18px;position:relative;z-index:2;}
  .btn:hover{transform:scale(1.1);background:#444;transition:all 0.3s ease;}
  .btn-glow{animation:glowPulse 2s infinite;}
  @keyframes glowPulse {
    0%{box-shadow:0 0 5px #fff, 0 0 10px #87CEEB;}
    50%{box-shadow:0 0 20px #fff, 0 0 30px #1e90ff;}
    100%{box-shadow:0 0 5px #fff, 0 0 10px #87CEEB;}
  }

  /* 開場 banner */
  .banner-wrap {
    width: 100%; max-height: 280px;
    display:flex;justify-content:center;align-items:center;overflow:hidden;position:relative;
  }
  .banner {
    max-width:100%; max-height:100%; object-fit:contain;
    animation: zoomFade 3s ease forwards;
    transition: opacity 1s ease;
  }
  @keyframes zoomFade {
    0%{opacity:0; transform:scale(0.9);}
    100%{opacity:1; transform:scale(1);}
  }

  /* 標題文字動畫 */
  .game-title{
    font-size:32px;font-weight:bold;color:#222;margin:12px 0;text-shadow:2px 2px 4px #fff;
    animation:titleFloat 3s ease-in-out infinite;
  }
  @keyframes titleFloat{
    0%,100%{transform:translateY(0);}
    50%{transform:translateY(-8px);}
  }

  .small{font-size:14px;color:#333;animation:fadeIn 3s ease;}
  @keyframes fadeIn{from{opacity:0;}to{opacity:1;}}

  .flex-row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:12px;}
  .char{width:150px;border:3px solid #111;padding:6px;background:#fff;border-radius:6px;cursor:pointer;text-align:center;}
  .char img{width:100%;height:120px;object-fit:contain;display:block;}
  .panel{background:#fff;padding:10px;border-radius:6px;border:3px solid #000;margin-top:12px;min-height:110px;}
  .hidden{display:none;}
  .question{font-size:20px;margin-bottom:8px;}
  .result{font-weight:700;font-size:22px;margin-top:8px;}
  .topbar{display:flex;justify-content:space-between;align-items:center;}

  /* 血條設計 */
  .health-container{width:220px;height:20px;background:#222;border-radius:4px;margin-top:6px;overflow:hidden;}
  .health-bar{height:100%;width:100%;background-color:#4caf50;transition:width 0.7s ease, background-color 0.7s ease;}
  @keyframes attackFlash{0%,100%{filter:brightness(1);}50%{filter:brightness(1.5);}}
  .attack-flash{animation:attackFlash 0.3s ease 2;}
  .damage-text{position:absolute;font-weight:bold;font-size:24px;color:red;text-shadow:1px 1px 2px #000;pointer-events:none;animation:floatUp 1s ease forwards;}
  @keyframes floatUp{0%{opacity:1;transform:translateY(0);}100%{opacity:0;transform:translateY(-50px);}}

  /* 對戰開始特效 */
  #battleStartText{
    position:absolute;top:40%;left:50%;transform:translate(-50%,-50%);
    font-size:40px;font-weight:bold;color:#ff3333;text-shadow:2px 2px 6px #000;
    animation:flashScale 1.5s ease forwards;
    z-index:10;
  }
  @keyframes flashScale{
    0%{opacity:0;transform:translate(-50%,-50%) scale(0.5);}
    50%{opacity:1;transform:translate(-50%,-50%) scale(1.2);}
    100%{opacity:0;transform:translate(-50%,-50%) scale(1);}
  }
</style>
</head>
<body>
<div class="screen">
  <!-- 開始畫面 -->
  <div id="startScreen" class="center">
    <div class="banner-wrap">
      <img class="banner" id="bannerImg"
           src="https://i.postimg.cc/vHsKby4Q/20250818-1101-Q-remix-01k2xhxbece2rvn2k7wwpajv86.png"
           alt="遊戲封面">
    </div>
    <div class="game-title">GBA 問答對戰小遊戲</div>
    <div style="margin-top:10px; animation:fadeIn 2s ease;">
      <button class="btn btn-glow" id="toSelect">開始遊戲</button>
    </div>
    <div class="small" style="margin-top:8px;">規則：一題定生死！</div>
  </div>

  <!-- 角色選擇 -->
  <div id="selectScreen" class="hidden center">
    <div class="topbar" style="width:100%">
      <div><strong>選擇你的角色</strong></div>
      <div><button class="btn" id="backToStart">返回</button></div>
    </div>
    <div class="flex-row" id="chars"></div>
    <div class="panel">選好角色後，挑戰一般對手或最終王！</div>
  </div>

  <!-- 對手選擇 -->
  <div id="opponentScreen" class="hidden center">
    <div class="topbar" style="width:100%">
      <div><strong>選擇對手</strong></div>
      <div><button class="btn" id="backToSelect">返回角色選單</button></div>
    </div>
    <div class="flex-row" id="opponents"></div>
    <div class="panel">一題勝負！答對敵方倒下，答錯玩家倒下！</div>
  </div>

  <!-- 對戰畫面 -->
  <div id="battleScreen" class="hidden center">
    <div class="topbar" style="width:100%">
      <div><strong id="battleTitle">對戰開始</strong></div>
      <div><button class="btn" id="backToStartFromBattle">回主選單</button></div>
    </div>
    <div class="panel" style="position:relative;">
      <div id="battleStartText" class="hidden">⚡ 對戰開始！⚡</div>
      <div style="display:flex;justify-content:space-between;align-items:center;position:relative;">
        <div style="width:45%;text-align:center;position:relative;">
          <div id="playerName">你</div>
          <div id="player" style="position:relative;">
            <img id="playerImg" src="" style="width:100%;max-width:220px;height:140px;object-fit:contain;border:3px solid #000;background:#fff;margin-top:6px;">
          </div>
          <div class="health-container"><div id="playerHealthBar" class="health-bar"></div></div>
        </div>
        <div style="width:45%;text-align:center;position:relative;">
          <div id="enemyName">對手</div>
          <div id="enemy" style="position:relative;">
            <img id="enemyImg" src="" style="width:100%;max-width:220px;height:140px;object-fit:contain;border:3px solid #000;background:#fff;margin-top:6px;">
          </div>
          <div class="health-container"><div id="enemyHealthBar" class="health-bar"></div></div>
        </div>
      </div>

      <div id="qArea" style="margin-top:12px;">
        <div class="question" id="questionText"></div>
        <input id="answerInput" placeholder="在這裡輸入答案" style="padding:8px;width:60%;font-size:16px;border:2px solid #333;border-radius:6px;">
        <div style="margin-top:8px;">
          <button class="btn" id="submitAns">送出</button>
          <button class="btn" id="skipQ">跳過（算錯）</button>
        </div>
      </div>

      <div id="outcome" class="hidden">
        <div class="result" id="outcomeText"></div>
        <div style="margin-top:8px;">
          <button class="btn" id="playAgain">再玩一次</button>
          <button class="btn" id="toSelect2">選角色</button>
        </div>
      </div>
    </div>
  </div>

  <audio id="victoryAudio" src="One Minute Victory.mp3"></audio>
</div>

<script>
// Data
const chars = [
  {name:'角色 A', img:'https://i.postimg.cc/kM2KKGTX/202509164.png'},
  {name:'角色 B', img:'https://i.postimg.cc/SxhMBrkJ/20250916-5.png'},
  {name:'角色 C', img:'https://i.postimg.cc/Xq5rhZPf/20250916-2.png'},
  {name:'角色 D', img:'https://i.postimg.cc/k5ZXmJKf/20250916-3.png'}
];
const boss = {name:'最終王', img:'https://i.postimg.cc/WbRFZnDX/20250916-1.png'};

// Questions
const mathQs = [
  {q:'5 + 7 = ?', a:'12'},
  {q:'9 - 4 = ?', a:'5'},
  {q:'6 × 3 = ?', a:'18'}
];
const bossQ = {q:'我是誰？', a:'孫中山'};

// State
let player=null, enemy=null, currentQ=null;
let playerHP=100, enemyHP=100;

// helpers
function show(id){document.getElementById(id).classList.remove('hidden');}
function hide(id){document.getElementById(id).classList.add('hidden');}
function updateHealthBar(barElement, currentHP){
  const percent = Math.max(0, Math.min(100, currentHP));
  barElement.style.width = percent + '%';
  if(percent>50) barElement.style.backgroundColor='#4caf50';
  else if(percent>20) barElement.style.backgroundColor='#ffeb3b';
  else barElement.style.backgroundColor='#f44336';
}
function playAttackAnimation(targetId, damage){
  const el=document.getElementById(targetId);
  if(!el) return;
  el.classList.add('attack-flash');
  setTimeout(()=>el.classList.remove('attack-flash'),600);
  const dmg=document.createElement('div');
  dmg.className='damage-text';
  dmg.textContent='-'+damage;
  el.appendChild(dmg);
  dmg.addEventListener('animationend',()=>el.removeChild(dmg));
}

// init characters
function initCharSelect(){
  const ctn=document.getElementById('chars');
  ctn.innerHTML='';
  chars.forEach(c=>{
    const el=document.createElement('div');
    el.className='char';
    el.innerHTML=`<img src="${c.img}"><div><strong>${c.name}</strong></div>`;
    el.onclick=()=>{player=c; openOpponentSelect();};
    ctn.appendChild(el);
  });
}
function openOpponentSelect(){
  hide('startScreen'); hide('selectScreen'); hide('battleScreen');
  show('opponentScreen');
  const ctn=document.getElementById('opponents');
  ctn.innerHTML='';
  chars.forEach((c,i)=>{
    const el=document.createElement('div');
    el.className='char';
    el.innerHTML=`<img src="${c.img}"><div><strong>對手 ${i+1}</strong></div>`;
    el.onclick=()=>{enemy=c; startBattle(false);};
    ctn.appendChild(el);
  });
  const bossEl=document.createElement('div');
  bossEl.className='char';
  bossEl.innerHTML=`<img src="${boss.img}"><div><strong>${boss.name}</strong></div>`;
  bossEl.onclick=()=>{enemy=boss; startBattle(true);};
  ctn.appendChild(bossEl);
}
function startBattle(isBoss){
  playerHP=100; enemyHP=100;
  hide('startScreen'); hide('selectScreen'); hide('opponentScreen');
  document.getElementById('playerImg').src=player.img;
  document.getElementById('playerName').textContent=player.name;
  document.getElementById('enemyImg').src=enemy.img;
  document.getElementById('enemyName').textContent=enemy.name;
  updateHealthBar(document.getElementById('playerHealthBar'), playerHP);
  updateHealthBar(document.getElementById('enemyHealthBar'), enemyHP);
  document.getElementById('outcome').classList.add('hidden');
  document.getElementById('qArea').classList.add('hidden');
  show('battleScreen');
  // 對戰開始特效
  const battleText=document.getElementById('battleStartText');
  show('battleStartText');
  setTimeout(()=>{hide('battleStartText');document.getElementById('qArea').classList.remove('hidden');},1500);
  currentQ=isBoss?bossQ:mathQs[Math.floor(Math.random()*mathQs.length)];
  document.getElementById('questionText').textContent=currentQ.q;
}
function submitAnswer(){
  const input=document.getElementById('answerInput').value.trim();
  if(input===currentQ.a){
    enemyHP=0;
    updateHealthBar(document.getElementById('enemyHealthBar'), enemyHP);
    playAttackAnimation('enemy',100);
    finishBattle(true);
  }else{
    playerHP=0;
    updateHealthBar(document.getElementById('playerHealthBar'), playerHP);
    playAttackAnimation('player',100);
    finishBattle(false);
  }
}
function skipQuestion(){submitAnswer();}

function finishBattle(isWin){
  document.getElementById('qArea').classList.add('hidden');
  const txt=document.getElementById('outcomeText');
  if(isWin){
    txt.textContent='勝利！你贏了！';
    try{document.getElementById('victoryAudio').play();}catch(e){}
  }else{
    txt.textContent='失敗…請再試一次。';
  }
  document.getElementById('outcome').classList.remove('hidden');
}

// Events
document.getElementById('toSelect').onclick=()=>{hide('startScreen');show('selectScreen');initCharSelect();};
document.getElementById('backToStart').onclick=()=>{hide('selectScreen');show('startScreen');};
document.getElementById('backToSelect').onclick=()=>{hide('opponentScreen');show('selectScreen');};
document.getElementById('backToStartFromBattle').onclick=()=>{hide('battleScreen');show('startScreen');};
document.getElementById('submitAns').onclick=submitAnswer;
document.getElementById('skipQ').onclick=skipQuestion;
document.getElementById('playAgain').onclick=()=>{show('selectScreen');hide('battleScreen');initCharSelect();};
document.getElementById('toSelect2').onclick=()=>{show('selectScreen');hide('battleScreen');initCharSelect();};

// Banner 輪播
const banners = [
  "https://i.postimg.cc/vHsKby4Q/20250818-1101-Q-remix-01k2xhxbece2rvn2k7wwpajv86.png",
  "https://i.postimg.cc/7hDN8xmd/20250818-1101-Q-remix-01k2xhxbece2rvn2k7wwpajv87.png"
];
let bannerIndex = 0;
setInterval(()=>{
  bannerIndex = (bannerIndex+1) % banners.length;
  const bannerEl = document.getElementById("bannerImg");
  bannerEl.style.opacity = 0;
  setTimeout(()=>{
    bannerEl.src = banners[bannerIndex];
    bannerEl.style.opacity = 1;
  }, 500);
}, 4000);
</script>
</body>
</html>
